<!DOCTYPE html>
<html lang="ca">



<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+JP">
    <link rel="stylesheet" href="../../../css/main.css">

    
    <title>7. Ampliació de l&#39;aplicació MyPlaces. Navigation Drawer, Fragments, MVVM, View Binding.</title>
</head>

<body>
    
    <div class="header-container">
        
        
        
        <nav>
            <ul>
                
                <li class="mainNavigation">
                    <a href="https://socquique.github.io/2dam/PSP" title="PSP">
                        PSP
                    </a>
                </li>
                
                <li class="mainNavigation">
                    <a href="https://socquique.github.io/2dam/PMDM" title="PMDM">
                        PMDM
                    </a>
                </li>
                
            </ul>
        </nav>
        
    </div>

    
    <div class="main-container">
<nav>
    <h3>
        <a href="../index.html">
        Unitat 2. Programació d&#39;Android amb Kotlin</a>
    </h3>
    
        
        
        <div class="unitat">
            <a href="../0_javakotlin/index.html">0. Repàs de Java i introducció a Kotlin</a>
        </div>
        
        <div class="unitat">
            <a href="../1_androidstudio/index.html">1. Android Studio i Kotlin. Primers pasos.</a>
        </div>
        
        <div class="unitat">
            <a href="../2_arquitecturaapps/index.html">2. Desenvolupament d&#39;apps en Android</a>
        </div>
        
        <div class="unitat">
            <a href="../3_elemensui/index.html">3. Elements de la interfície</a>
        </div>
        
        <div class="unitat">
            <a href="../4_recyclerview/index.html">4. El component RecyclerView</a>
        </div>
        
        <div class="unitat">
            <a href="../5_eventsrecyclerview/index.html">5. Gestió d&#39;events als RecyclerView</a>
        </div>
        
        <div class="unitat">
            <a href="../6_menus/index.html">6. Menús en Android I</a>
        </div>
        
        <div class="unitat">
            <a href="index.html">7. Ampliació de l&#39;aplicació MyPlaces. Navigation Drawer, Fragments, MVVM, View Binding.</a>
        </div>
        
        <div class="unitat">
            <a href="../8_myplaces2_2/index.html">8. Ampliació de l&#39;aplicació MyPlaces. Intents amb retorn, Galeria, Emmagatzemament i Maps.</a>
        </div>
        
    
</nav>
    <article>
        <header> 
            <h1>7. Ampliació de l&#39;aplicació MyPlaces. Navigation Drawer, Fragments, MVVM, View Binding.</h1>
        </header>
        <p>En aquesta unitat anem a donar-li un enfoc més pràctic als continguts que ens queden d&rsquo;Android, i per a això anem a reprendre l&rsquo;aplicació <em>MyPlaces</em> (<em>DamLlocs</em>) que ja coneixeu i a partir d&rsquo;ella fer una versió 2.0 amb més funcionalitat. Aprofitarem parts del codi i algunes activitats d&rsquo;aquesta, però partirem d&rsquo;un projecte nou.</p>
<h2 id="1-creació-del-projecte">1. Creació del projecte</h2>
<p>Crearem un projecte nou, partint de la plantilla <em>Navigation Drawer Activity</em>, i li posarem per nom MyPlaces2. Aquesta plantilla ja ens crea una estructura de projecte predeterminada que girarà al voltant d&rsquo;un element de tipus <em>Navigation Drawer</em>.</p>
<p>El <em>Navigation Drawer</em> és un element d&rsquo;interfície definit per <em>Material Design</em> i que consisteix en un menú lateral lliscant que serveix com a principal element de navegació, i que és accessible bé a través d&rsquo;un botó a la barra de l&rsquo;aplicació o bé lliscant el contingut de la pantalla des de la vore esquerra.</p>
<p><img src="../img/myplaces_1.png" alt="Creació del projecte"></p>
<p>Si donem un cop d&rsquo;ull al resultat d&rsquo;aplicar aquesta plantilla veurem que ens crea una estructura bastant completa:</p>
<p><img src="../img/my_places_2_estructura.png" alt="Estructura del projecte"></p>
<p>Com podem comprovar, ens genera diversos recursos de tipus <em>layout</em>, un parell de tipus <em>menú</em> i un de tipus <em>navigation</em>. A més, a banda de la classe <em>MainActivity</em>, tenim altres classes de tipus <em>Fragment</em> i <em>Model</em>, organitzades dins una carpeta <em>ui</em>.</p>
<p>En estos moments, ja podem llançar l&rsquo;aplicació per tal de vore quin és el seu funcionament general.</p>
<p>Anem a analitzar aquesta organització de recursos, fent ús del següent esquema on s&rsquo;aprecia la relació entre aquests i el seu aspecte.</p>
<p><img src="../img/layoutsNavView.png" alt="Elements del projecte"></p>
<p>Partim del disseny de l&rsquo;activitat principal <em>activity_main.xml</em> (<em>DrawerLayout</em>), que es compon principalment de dos elements:</p>
<ul>
<li>El <strong>contingut</strong> de l&rsquo;activitat, incorporat amb un include i fent referència al recurs <em>layout/app_bar_main</em>, definit al fitxer <em>layout/app_bar_main.xml</em>.</li>
<li>El <strong>component NavigationView</strong>, que conté una capçalera (recurs <em>@layout/nav_header_main</em>; fitxer <em>layout/nav_header_main.xml</em>) i un menú <em>@menu/activity_main_drawer</em> (fitxer <em>menu/activity_main_drawer.xml</em>).</li>
</ul>
<p>El fitxer <em>app_bar_main.xml</em>, conté les diferents pantalles de què es compon l&rsquo;aplicació, però a diferència d&rsquo;altres projecte que hem vist, ho fa en forma de <em>fragments</em> en lloc d'<em>Activitats</em>. Els <strong>fragments</strong> són components en què podem dividir la interfície d&rsquo;usuari, de manera que puguem combinar-los per generar una única activitat, permetent-nos així la reutilització i una millor millor organització del codi.</p>
<p>Aquest fitxer <em>app_bar_main.xml</em> defineix doncs l&rsquo;aspecte general de les pantalles amb contingut de la nostra activitat, i defineix una barra d&rsquo;aplicació (AppBarLayout), el contingut (<em>@layout_content_main</em>), i un botó flotant.</p>
<p>El Layout <em>content_main</em> (fitxer <em>layout/content_main.xml</em>), conté un fragment que referencia a un recurs de tipus <em>NavGraph</em>. Aquests recursos són col·leccions de nodes accessibles a través d&rsquo;un ID. Al nostre cas, aquest fa referència al recurs <em>navigation/mobile_navigation.xml</em>, que inclou tres fragments en tres documents diferents: <em>@layout/fragment_home</em>, <em>@layout/fragment_gallery</em>, <em>@layout/fragment_slideshow</em>.</p>
<p>Pel que fa als menús, podem veure que al recurs <em>menu/activity_main_drawer.xml</em>, tenim definit un grup amb tres items, que fan referència, justament als tres fragments del recurs <em>Navigation</em> que tenim a dalt. A més, si ens fixem en la imatge anterior, on véiem la distribució dels fitxers de codi font, recordem que disposàvem d&rsquo;una carpeta <em>ui</em> dins el paquet. Fixeu-vos que el codi font d&rsquo;aquestes carpetes el que fa és gestionar cadascun d&rsquo;aquests fragments.</p>
<p>Com podem vore, es tracta d&rsquo;una plantilla que parteix d&rsquo;una mena de galería d&rsquo;imatges, amb una pàgina inicial, la galería i un Slideshow.</p>
<p>A partir d&rsquo;aquesta plantilla inicial, podem afegir modificacions o nous elements per tal de generar la funcionalitat que busquem.</p>
<p>Per exemple, què fariem si&hellip;</p>
<ul>
<li><em>Volguèrem modificar el disseny de la capçalera del menú?</em> Doncs modificaríem el fitxer <em>layout/nav_headeR_main.xml</em> per afegir una nova imatge al component <em>ImageView</em> i modificant els recursos d&rsquo;String corresponents als dos TextViews.</li>
<li><em>Volguérem eliminar alguna opció de les que hi ha al menú (per exemple, l&rsquo;SlideShow)?</em> Hauriem d&rsquo;eliminar el fragment corresponent, eliminant el fitxer <em>layout/fragment_slideshow.xml</em> i l&rsquo;element <em>Fragment</em> del recurs <em>navigation/mobile_navigation.xml</em> que fa referència a aquest Slideshow. També eliminariem la corresponent entrada al recurs de menú <em>menu/activity_main_drawer.xml</em>, així com la subcarpeta de fonts ui/slideshow.</li>
<li><em>Volguérem afegir una entrada nova?</em> Doncs caldria crear un nou fitxer layout/fragment_nou.xml*, afegir el *Fragment* al recurs *navigation/mobile_navigation.xml* i afegir l&rsquo;entrada al recurs de menú *menu/activity_main_drawer.xml*. A més, afegiriem la funicionalitat dins una nova carpeta dins la carpeta *ui* del nostre paquet.</li>
<li><em>I per readaptar l&rsquo;estructura creada a un projecte diferent?</em> En aquest cas, podem renomenar i refactoritzar els components ja creats per tal que s&rsquo;adapten al què necessitem.</li>
</ul>
<blockquote>
<p><em><strong>Documentació oficial sobre Fragments i NavGraph</strong></em></p>
<ul>
<li>
<p><a href="https://developer.android.com/guide/components/fragments?hl=es">https://developer.android.com/guide/components/fragments?hl=es</a></p>
</li>
<li>
<p><a href="https://developer.android.com/reference/kotlin/androidx/navigation/NavGraph">https://developer.android.com/reference/kotlin/androidx/navigation/NavGraph</a></p>
</li>
</ul>
</blockquote>
<h2 id="2-adaptant-myplacesdamllocs-a-lestructura-de-myplaces-20">2. Adaptant MyPlaces/DamLlocs a l&rsquo;estructura de MyPlaces 2.0</h2>
<p>Anem a partir ara del codi generat per a l&rsquo;aplicació DamLlocs, i adaptar-lo a aquesta estructura. Per a això, incorporarem a l&rsquo;estructura de navegació la pantalla amb la llista de llocs i la pantalla d'<em>About</em>. Recordem que l&rsquo;activitat per afegir nous llocs i modificar un lloc no s&rsquo;incloïa en el menú, pel que la mantindrem separada.</p>
<p>Les diferents adaptacions que farem seran les següents:</p>
<ul>
<li><strong>Reutilització de la pantalla <code>layout/fragment_home</code> per emmagatzemar la llista de llocs</strong>. Aquesta serà la pantalla principal, que recordem, estarà guardada com un fragment dins l&rsquo;estructura de navegació que tenim enllaçada a l&rsquo;activitat principal (busqueu a l&rsquo;esquema general on es troba el <em>fragment_home</em> i com s&rsquo;arriba a ell des de l'<em>activity_main</em>).</li>
<li><strong>Refactorització de la pantalla <code>layout/fragment_gallery</code> per <code>layout/fragment_about</code>, per afegir informació sobre l&rsquo;aplicació</strong>. En aquest cas, partirem de l&rsquo;activitat d&rsquo;About que teníem, però afegint alguna informació més.</li>
<li><strong>Modificar el <em>Navigation Drawer</em> per personalitzar la capçalera i les opcions de menú corresponents</strong>. Ací aprendrem també a afegir nous recursos de tipus imatge.</li>
<li><strong>Incorporar l&rsquo;activitat d&rsquo;edició de llocs</strong> per editar i afegir llocs nous. Aquesta activitat serà independent del <em>Navigation Drawer</em>, i accedirem a ella també a través de diferents <em>Intents</em>, bé siguen per afegir nous llocs o modificar els existents.</li>
</ul>
<h2 id="3-adaptació-de-la-llista-de-llocs">3. Adaptació de la llista de llocs</h2>
<p>En aquest apartat anem a veure com adaptar a la nova estructura la pantalla amb el <em>RecyclerView</em> dels diferents llocs. Tindrem dos dificultats: per una banda, passar d&rsquo;una activitat a un fragment, i per altra banda, entendre el model <em>MVVM</em> en què es basa aquesta plantilla.</p>
<p>Per tot açò, anem a anar seguint els següents passos, i anirem introduïnt conceptesa mesura que ens facen falta:</p>
<ol>
<li>
<p>Creem al nou projecte el fitxer font <code>Llocs.kt</code> (fem click sobre el nom del paquet amb el botó dret i seleccionem <em>New &gt; Kotlin Class/File</em>). Ens crearà un fitxer buit, amb la línia de definició del <em>package</em>. En aquest fitxer, copiarem directament (sense la definició del <em>package</em>) el contingut del fitxer <em>Llocs.kt</em> del nostre projecte inicial <em>DAMLlocs</em>. <strong>Si no el vàreu aconseguir implementar del tot, heu de fer-ho ara!</strong>.</p>
</li>
<li>
<p>Modificarem el fitxer d&rsquo;interfície <code>layout/fragment_home</code>, eliminant el component <em>TextView</em> que conté, i copiem a dins el component RecyclerView que teníem a la nostra implementació inicial. Ens quedarà el següent:</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>

<span style="color:#f92672">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> 
    <span style="color:#a6e22e">xmlns:android=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res/android&#34;</span>
    <span style="color:#a6e22e">xmlns:app=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res-auto&#34;</span>
    <span style="color:#a6e22e">xmlns:tools=</span><span style="color:#e6db74">&#34;http://schemas.android.com/tools&#34;</span>
    <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">tools:context=</span><span style="color:#e6db74">&#34;.ui.home.HomeFragment&#34;</span><span style="color:#f92672">&gt;</span>

<span style="color:#f92672">&lt;androidx.recyclerview.widget.RecyclerView</span>
    <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/RVLlocs&#34;</span>
    <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">tools:layout_editor_absoluteX=</span><span style="color:#e6db74">&#34;148dp&#34;</span>
    <span style="color:#a6e22e">tools:layout_editor_absoluteY=</span><span style="color:#e6db74">&#34;108dp&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</code></pre></div><ol start="3">
<li>Afegim un nou recurs de tipus layout per al <em>ViewHolder</em>, que anomenarem <code>lloc.xml</code> i que tindrà, de moment, el mateix contingut que al projecte DAMLLocs original:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;LinearLayout</span> 
    <span style="color:#a6e22e">xmlns:android=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res/android&#34;</span>
    <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;96dp&#34;</span>
    <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;vertical&#34;</span><span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;TextView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/nomLloc&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;0dp&#34;</span>
        <span style="color:#a6e22e">android:layout_weight=</span><span style="color:#e6db74">&#34;2&#34;</span>
        <span style="color:#a6e22e">android:gravity=</span><span style="color:#e6db74">&#34;center_vertical&#34;</span>
        <span style="color:#a6e22e">android:text=</span><span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#a6e22e">android:textColor=</span><span style="color:#e6db74">&#34;@color/black&#34;</span>
        <span style="color:#a6e22e">android:textSize=</span><span style="color:#e6db74">&#34;24sp&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;TextView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/descLloc&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_weight=</span><span style="color:#e6db74">&#34;1&#34;</span>
        <span style="color:#a6e22e">android:gravity=</span><span style="color:#e6db74">&#34;top&#34;</span>
        <span style="color:#a6e22e">android:text=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/LinearLayout&gt;</span>
</code></pre></div><ol start="4">
<li>
<p>Afegim dos nous fitxers fonts de kotlin dins la subcarpeta <em>home</em>: <em>AdaptadorLlocs.kt</em> i <em>LlocViewHolder.kt</em>. Com que utilitzarem recursos que hi ha al paquet de base, caldrà fer un <code>import com.ieschabas.pmdm.myplaces20.*</code>, ja que el paquet on estem ubicant aquestes funcions és <code>com.ieschabas.pmdm.myplaces20.ui.home</code>. De moment, no cal modificar res d&rsquo;aquestes classes.</p>
</li>
<li>
<p>Finalment anem a abordar el fitxer <code>HomeFragment.kt</code>, per a la qual cosa necessitarem introduir primer alguns conceptes nous sobre arquitectures i patrons de disseny d&rsquo;aplicacions mòbils, tal i com veurem al següent apartat.</p>
</li>
</ol>
<h3 id="31-el-model-mvvm">3.1. El model MVVM</h3>
<p>Les arquitectures o models de disseny ens permeten organitzar l&rsquo;estructura, el funcionament i la interacció entre les diferents parts d&rsquo;una aplicació.</p>
<p>En el món de la programació mòbil s&rsquo;han popularitzat tres models de disseny:</p>
<ul>
<li>El <strong>model MVC</strong> o <em>Model-Vista-Controlador</em>, que va ser la solució inicial per separar la interfície d&rsquo;usuari de la lògica de negoci, i que introduïa tres components principals: El <em><strong>Model</strong></em>, que era el responsable de la gestió de les dades (ja fos a través de fitxers, bases de dades o dades remotes), la <em><strong>Vista</strong></em>, que representa la interfície d&rsquo;usuari, i el <em><strong>Controlador</strong></em>, que és qui conté la lògica de negoci, des de la gestió d&rsquo;events fins al canvi de vistes o accés a les dades. La vista i el controlador depenen del model, i es defineixen al mateix lloc, ja siga una activitat o un fragment.</li>
<li>El <strong>model MVP</strong> o <em>Model-Vista-Presentador</em> que alleugera la càrrega de l&rsquo;activitat o fragment on es defineixen, extraien la tasca que feia el <em>controlador</em> a una nova entitat anomenada <em><strong>Presenter</strong></em>, que serà l&rsquo;encarregat d&rsquo;organtizar i coordinar tot el que va succeïnt entre el model i la vista.</li>
<li>I finalment, el model que ens aborda és el model <em><strong>MVVM</strong></em> o model <em>Model-Vista-ViewModel</em>. En aquest model, la <em>Vista</em> segueix l'<em>activitat</em> o <em>fragment</em> responsable de la visualització de les dades, però ho fa d&rsquo;una forma més <em>reactiva</em> o automatitzada. El responsable d&rsquo;açò és el component <em>ViewModel</em> que prepararà les dades <em>observables</em> per a la <em>Vista</em> a partir del <em>Model</em>. El principal avantatge és que els canvis són <em>reactius</em>, és a dir, la interfície es modifica com a <em>reaccció</em> als canvis en el <em>ViewModel</em>, de forma automàtica i també el <em>ViewModel</em> reacciona als canvis a la interfície modificant aquest, tot en temps real.</li>
</ul>
<p>Gràficament, podem vore aquest model <em>MVVM</em> de la següent manera:</p>
<p><img src="../img/mvvm.png" alt="Arquitectura Model-Vista-ViewModel"></p>
<p>Tenint en ment aquest model, anem a analitzar els fitxer <code>HomeFragment.kt</code> i el seu corresponent <em>ViewModel</em> <code>HomeViewModel.kt</code>.</p>
<p>Si ens fixem al codi generat automàticament per al <code>HomeFragment</code>, observarem el següent:</p>
<ul>
<li>Es tracta d&rsquo;una classe descendent de <code>Fragment</code>,</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomeFragment</span> : Fragment() {
    <span style="color:#f92672">..</span>.
}
</code></pre></div><ul>
<li>Declara un atribut <code>homeViewModel</code>, de tipus <code>HomeViewModel</code> (és a dir, el <em>ViewModel</em> que gestionarà aquest fragment), i que és privada i d'<em>inicialitzacació tadana (lateinit)</em>. Recordem que quan una variable és d&rsquo;un tipus que no accepta <em>null</em>, requereix que s&rsquo;inicialitze al constructor. En alguns casos, aquestes variables necessiten inicialitzar-se posteriorment, com per exemple, quan la inicialització es fa a partir d&rsquo;una injecció de dependències. El fet de marcar la propietat com a <em>lateint</em> ens serveix per resoldre aquestes situacions, indicant que la inicialització de la variable es farà de forma posterior a aquesta declaració.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> homeViewModel: HomeViewModel
</code></pre></div><ul>
<li>I finalment, sobreescriu el mètode <code>onCreateView</code> del Fragment, que captura l&rsquo;event de creació de la vista, i vindria a ser equiparable al mètode <code>onCreate</code> de les <em>Activities</em>. La seua tasca en capturar aquest event serà preparar la vista per a la seua presentació.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreateView</span>(
            inflater: LayoutInflater,
            container: ViewGroup?,
            savedInstanceState: Bundle?
    ): View? {
        homeViewModel = ViewModelProvider(<span style="color:#66d9ef">this</span>).<span style="color:#66d9ef">get</span>(HomeViewModel<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
        <span style="color:#66d9ef">val</span> root = inflater.inflate(R.layout.fragment_home, container, <span style="color:#66d9ef">false</span>)
        <span style="color:#66d9ef">val</span> textView: TextView = root.findViewById(R.id.text_home)
        
        homeViewModel.text.observe(viewLifecycleOwner, Observer {
            textView.text = <span style="color:#66d9ef">it</span>
        })
        <span style="color:#66d9ef">return</span> root
    }
</code></pre></div><p>Com veiem, aquest mètode rep un <em><strong>inflatter</strong></em>, per instanciar un recurs de tipus layout en format XML als seus objectes de vista corresponents, un <em><strong>container</strong></em>, que és el <em>ViewGroup</em> on s&rsquo;ubica el fragment, i un objecte de tipus <em>Bundle</em>. El seu valor de retorn serà l&rsquo;objecte de tipus <em>View</em> associat a l&rsquo;arrel del Layout.</p>
<p>Internament, aquest mètode <code>onCreateView</code>, en primer lloc, instancia el corresponent <em>ViewModel</em>, i després, instancia el fitxer de <em>Layout</em> <code>fragment_home.xml</code> mitjançat l'<em>inflatter</em>. El resultat d&rsquo;aquesta instanciació serà l&rsquo;arrel de la vista que estem creant.</p>
<p>Finalment, estableix un <em>observador</em> per al TextView que inicialment contenía el Layout, però que hem eliminat per reemplaçar-lo pel nostre RecyclerView.</p>
<p>Si ens fixem ara en el <em><strong>HomeViewModel</strong></em>, veiem primer que res que aquest és una extensió de <code>ViewModel</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomeViewModel</span> : ViewModel() {<span style="color:#f92672">..</span>.}
</code></pre></div><p>Els <em>ViewModels</em> són classes dissenyades per tal d&rsquo;emmagatzemar i administrar dades relacionades amb la interfície d&rsquo;usuari, de forma conscient al cicle de vida, amb el que es permet que les dades <em>sobrevisquen</em> als canvis de configuració (com per exemple una rotació de pantalla). Aquests <em>ViewModels</em> no es destrueixen quan hi ha un canvi de configuració. Quan es destrueix una vista i se&rsquo;n crea una de nova, la nova vista es reconnecta al ViewModel existent. A més, aquests ViewModels s&rsquo;encarreguen de comunicar-se amb els repositoris de dades, ja siguen accessos a bases de dades, fitxers o consultes a una API.</p>
<p>Tornant al <em>HomeViewModel</em>, veiem com aquesta defineix l&rsquo;atribut <em>_text</em> de la següent manera:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> _text = MutableLiveData&lt;String&gt;().apply {
        value = <span style="color:#e6db74">&#34;This is home Fragment&#34;</span>
    }
    <span style="color:#66d9ef">val</span> text: LiveData&lt;String&gt; = _text

    }
</code></pre></div><p>Aquest objecte es defineix com <code>MutableLiveData&lt;String&gt;</code>. Els <em>LiveData</em> són objectes <em>observables</em>, que envíen als <em>observadors</em> els canvis que es produeixen, de forma <em>reaciva</em>, sense tocar la interfície d&rsquo;usuari. Aquests LiveData també tenen en consideració el cicle de vida, de manera que només s&rsquo;actualitzen les dades quan l&rsquo;activitat és a la patalla. Si es produeixen canvis a les dades, aquestes s&rsquo;actualitzaran al <em>ViewModel</em> quan es mostre el fragment a la pantalla.</p>
<p>Tornem a analitzar el codi del mètode <code>onCreateView</code> de <em>HomeFragment</em>. En primer lloc, estableix el seu <em>ViewModel</em> com a:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">homeViewModel = ViewModelProvider(<span style="color:#66d9ef">this</span>).<span style="color:#66d9ef">get</span>(HomeViewModel<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
</code></pre></div><p>Amb açò, fa ús de la classe <code>ViewModelProvider</code> (<em><code>androidx.lifecycle.ViewModelProvider</code></em>) per inicialitzar el <em>homeViewModel</em> a partir de la classe <em>HomeViewModel</em> (fixeu-vos que una, en minúscula és un atribut de la classe <em>HomeFragment</em>, mentre que en majúscula és la classe de tipus <em>ViewModel</em> que defineix aquest).</p>
<p>Posteriorment, després d'<em>unflar</em> la vista i inicialitzar el <em>TextView</em> a l&rsquo;element corresponent de la interfície, fa el següent codi:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">homeViewModel.text.observe(viewLifecycleOwner, Observer {
    textView.text = <span style="color:#66d9ef">it</span>
    })
<span style="color:#66d9ef">return</span> root
</code></pre></div><p>Aquest <code>homeViewModel.text</code> és la propietat text del ViewModel que hem definit com a <em>LiveData</em>, pel que és una propietat <em>observable</em>. Amb això, podem utilitzar aquest mètode <code>.observe</code>amb el que subscrivim el <code>textView.text</code> de la interfície a l&rsquo;atribut <em>text</em> que tenim al homeViewModel.</p>
<p>En aquest punt, cal fer una xicoteta observació respecte a l&rsquo;accés als elements de la interfície. Fixeu-vos que no estem utilitzant els Synthetics de les extensions de Kotlin, sinò que en el seu lloc, s&rsquo;utilitzen, de moment els <em>findViewById</em>. Aquestes extensions han estat <em>deprecades</em> a la versió 1.4.20-M2, per diversos motius. Veurem més avant quines són les alternatives que s&rsquo;han proposat per reemplaçar-les.</p>
<blockquote>
<p><strong>Documentació Addicional</strong></p>
<ul>
<li>
<p><a href="https://platzi.com/blog/arquitecturas-de-software-en-android-mvc-mvp-y-mvvm/">Arquitectures de software en Android</a></p>
</li>
<li>
<p><a href="https://developer.android.com/topic/libraries/view-binding?hl=es-419">Documentació oficial sobre View Binding</a></p>
</li>
</ul>
<p><strong>Videotutorials</strong></p>
<ul>
<li>
<p><a href="https://youtu.be/3vQcVAvwpCw">Arquitecturas Android en 2020 &gt; MVP, MVVM y Clean Architecture</a></p>
</li>
<li>
<p><a href="https://youtu.be/UrIFdZZwo6g">Tutorial MVVM</a></p>
</li>
</ul>
</blockquote>
<h3 id="32-divisió-de-funcionalitat-entre-la-vista-i-el-viewmodel">3.2. Divisió de funcionalitat entre la vista i el ViewModel</h3>
<p>Al projecte DAMLlocs original, l&rsquo;activitat principal gestionava tant la interfície com la part de gestió del negoci, accedint directament a l&rsquo;objecte <em>Llocs</em>, que faría de model en una estructura típica MVC.</p>
<p>Ara, amb una arquitectura MVVC, cal dividir la funcionalitat que hi teníem en aquesta classe principal i decidir què gestionarà la vista (el fragment) i què el ViewModel. En principi, la vista només s&rsquo;hauria d&rsquo;encarregar de la gestió de la interfície d&rsquo;usuari (el component RecyclerView) i el ViewModel la lògica de l&rsquo;aplicació.</p>
<p>Tenint en compte açò, una distribució més o menys lògica passaria per:</p>
<ul>
<li>La classe <em>HomeFragment</em>, que gestiona la vista serà qui s&rsquo;encarregue del <em>RecyclerView RVLlocs</em> i establirà el seu disseny (<em>Layout Manager</em>),</li>
<li>La classe <em>HomeViewModel</em> serà qui gestione la lògica de la pantalla, encarregant-se de la gestió de l&rsquo;adaptador (<em>AdaptadorLlocs</em>) lligat al <em>RecyclerView</em>,</li>
<li>La classe <em>HomeViewModel</em>, a més, definirà l'<em>Adaptador</em> com un <em>LiveData</em>, de manera que des de la classe <em>homeFragment</em> es puguen establir <em>observadors</em> per actualitzar la interfície quan es modifique l&rsquo;adaptador,</li>
<li>La gestió dels events serà gestionada entre les dues classes. Si recordem, els events es detectàven a la classe <em>llocViewHolder</em>, és a dir, en cada entrada individual del RecyclerView, i féiem ús de funcions de callback per tal d&rsquo;especificar què fer des del ViewHolder quan es detectava l&rsquo;event. En aquest cas, a més, tenim la dificultat afegida de que per obrir una nova activitat (com editar un lloc), hem de llançar les <em>Intents</em> des del fragment, però qui crea l&rsquo;adaptador no és el fragment sinò el ViewModel. El que caldrà fer en aquest cas serà:
<ul>
<li>Definir dos atributs <em>MutableLiveData</em> a la <em>HomeViewModel</em> que contindran un objecte de tipus <em>Lloc</em>, i que seran observades des de la classe <em>HomeFragment</em>, aquests atributs s&rsquo;anomenaran <em>llocClicked</em> i <em>llocLongClicked</em> (compte que abans els callbacks rebien aquest nom)</li>
<li>Crearem dos funcions de callback que passarem en la creació de l&rsquo;adaptador, i que anomenarem <em>llocClickedManager</em> i <em>llocLongClickedManager</em>, i que únicament establiran el valor de <em>llocClicked</em> i <em>llocLongClicked</em> amb el lloc sobre el que s&rsquo;haja fet clic al <em>ViewHolder</em>,</li>
<li>A la classe <em>HomeFragment</em> establirem dos observadors per a cadascuna d&rsquo;aquestes variables, de manera que quan prenguen valor, el que farem serà ressetejar-les (per a següents usos), i realitzar, ara sí, les accions corresponents, com puguen ser mostrar el diàleg de confirmació de l&rsquo;esborrat o llançar una <em>Intent</em> per obrir altra activitat.</li>
</ul>
</li>
</ul>
<p>Veiem amb tot açò com quedaria més o menys el codi d&rsquo;aquestes dues classes:</p>
<ul>
<li><strong>Classe <em>HomeFragment</em></strong>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">package</span> com.ieschabas.pmdm.myplaces20.ui.home

<span style="color:#66d9ef">import</span> ...

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomeFragment</span> : Fragment() {

    <span style="color:#75715e">// Definim una instància del ViewModel com a lateint
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> homeViewModel: HomeViewModel

    <span style="color:#75715e">// Mètode que es llança quan s&#39;ha de crear la vista
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Aquesta es crearà a partir de l&#39;XML i es retornarà en
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// l&#39;element root.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreateView</span>(
            inflater: LayoutInflater,
            container: ViewGroup?,
            savedInstanceState: Bundle?
    ): View? {
        <span style="color:#75715e">// Instanciem el homeViewModel fent ús de ViewModelProvider
</span><span style="color:#75715e"></span>        homeViewModel = ViewModelProvider(<span style="color:#66d9ef">this</span>).<span style="color:#66d9ef">get</span>(HomeViewModel<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
        <span style="color:#75715e">// I instanciem els elements de la interfície, a través de l&#39;inflater:
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// - El primer paràmetre d&#39;inflate és el recurs XML
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// - El segon paràmetre és un el contenidor dins el qual s&#39;instancia l&#39;XML
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// - El tercer paràmetre indica si la vista s&#39;ha d&#39;incloure immediatament
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   al contenidor o no. Com que estem en un fragment i aquesta vista l&#39;anem
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   a retornar, cal indicar &#34;false*
</span><span style="color:#75715e"></span>
        <span style="color:#66d9ef">val</span> root = inflater.inflate(R.layout.fragment_home, container, <span style="color:#66d9ef">false</span>)
        
        <span style="color:#75715e">// Localitzem el RecyclerView R.id.RVLlocs a la interfície
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// (recordeu que root conté la vista)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> RVLlocs: RecyclerView = root.findViewById(R.id.RVLlocs)

        <span style="color:#75715e">// Assignem un Layout Manager al nostre RecyclerView
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Cal especificar el context actual, ja que no reconeix this
</span><span style="color:#75715e"></span>        RVLlocs.layoutManager= LinearLayoutManager(context)
        
        <span style="color:#75715e">// Creem un Observer i el subscrivim al LiveData &#34;adaptador&#34; definit
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// al homeViewModel. Quan es produisquen canvis en aquest, es veuran
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// reflexats a l&#39;adaptador del RecyclerView RVLlocs.
</span><span style="color:#75715e"></span>        homeViewModel.adaptador.observe(viewLifecycleOwner, Observer {
            RVLlocs.adapter = <span style="color:#66d9ef">it</span>
        })

        <span style="color:#75715e">// Creem altre Observer i el subscrivim als canvis que es produïsquen
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// en l&#39;objecte llocClicked del homeViewModel. En aquest cas, per crear
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// l&#39;observer es rep el lloc sobre el que s&#39;ha fet clic.
</span><span style="color:#75715e"></span>        homeViewModel.llocClicked.observe(viewLifecycleOwner, Observer { lloc <span style="color:#f92672">-&gt;</span>
            lloc<span style="color:#f92672">?.</span>let {
                <span style="color:#75715e">// Resetegem el valor de llocClicked per tal que no 
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// estiga disponible per a futurs canvis
</span><span style="color:#75715e"></span>                homeViewModel.llocClicked.value = <span style="color:#66d9ef">null</span>
                
                <span style="color:#75715e">// I creem una Intent per modifica el lloc sobre el que s&#39;ha
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// fet clic.
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">val</span> intent = Intent(context, EditLloc<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
                intent.putExtra(<span style="color:#e6db74">&#34;nom&#34;</span>, lloc.nom);
                intent.putExtra(<span style="color:#e6db74">&#34;desc&#34;</span>, lloc.descripcio);
                intent.putExtra(<span style="color:#e6db74">&#34;tel&#34;</span>, lloc.telefon);
                intent.putExtra(<span style="color:#e6db74">&#34;web&#34;</span>, lloc.web);
                startActivity(intent)
            }
        })

        <span style="color:#75715e">// Creem un tercer Observer i el subscrivim als canvis que es produïsquen
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// en l&#39;objecte llocLongClicked del homeViewModel, igual que dalt.
</span><span style="color:#75715e"></span>        homeViewModel.llocLongClicked.observe(viewLifecycleOwner, Observer { lloc <span style="color:#f92672">-&gt;</span>
            lloc<span style="color:#f92672">?.</span>let {
                <span style="color:#75715e">// Ressetegem el valor
</span><span style="color:#75715e"></span>                homeViewModel.llocLongClicked.value = <span style="color:#66d9ef">null</span>

                <span style="color:#75715e">// I llancem l&#39;acció corresponent al clic llarg, en aquest cas
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// mostar el diàleg de confirmació per eliminar l&#39;element clicat.
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// En aquest cas, el mètode de callback que passem al diàleg per eliminar
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// el lloc, serà un mètode anomenat removeLloc que definirem al ViewModel, 
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// ja que des de la vista no podem accedir directament al model, i hem de
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// passar pel ViewModel per interactuar amb aquest.
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">val</span> elMeuDialegModal = confirmDeleteDialog (lloc.nom, { homeViewModel.removeLloc(lloc) })
                elMeuDialegModal.show(<span style="color:#66d9ef">this</span>.parentFragmentManager, <span style="color:#e6db74">&#34;confirmDialog&#34;</span>)

            }
        })

        <span style="color:#75715e">// I finalment, retornem l&#39;element root que conté la vista
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// amb tota la funcionalitat que hem incorporat.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> root
    }
}
</code></pre></div><ul>
<li><strong>Classe <em>HomeViewModel</em></strong>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomeViewModel</span> : ViewModel() {

    <span style="color:#75715e">// Definim les funcions de callback per a la gestió d&#39;events
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// L&#39;event el gestionarà el HomeFragment, però serà avisat
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// pel ViewModel de quan es produeixen els clicks en cada element.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Tant llocClicked com llocLongClicked seran definits com
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// LiveData, de manea que puguen ser observables per un
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// observador al fragment.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">llocClickedManager</span>(lloc: Lloc, v: View){
        <span style="color:#75715e">// Per establir el valor del liveData utilitzem value
</span><span style="color:#75715e"></span>        llocClicked.value=lloc
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">llocLongClickedManager</span>(lloc:Lloc, v: View) {
        <span style="color:#75715e">// Per establir el valor del liveData utilitzem value
</span><span style="color:#75715e"></span>        llocLongClicked.value=lloc
    }

    <span style="color:#75715e">// LiveData per a l&#39;adaptador: L&#39;adaptador del RecyclerView
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// també serà un LiveData per tal de ser observable des de la vista.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> _adaptador = MutableLiveData&lt;AdaptadorLlocs&gt;().apply{
        <span style="color:#75715e">// Amb value (setValue) establim el valor que tindrà el MutableLiveData
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// de tipus AdaptadorLlocs. Aci passarem també els callbacks que
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// s&#39;han d&#39;invocar quan es produisquen els clicks.
</span><span style="color:#75715e"></span>        value=AdaptadorLlocs(
            {lloc:Lloc, v: View <span style="color:#f92672">-&gt;</span> llocClickedManager(lloc, v)},
            { lloc: Lloc, v: View <span style="color:#f92672">-&gt;</span> llocLongClickedManager(lloc, v)}
        )
    }

    <span style="color:#75715e">// Aquesta és la propietat que es podrà llegir des de la vista
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// (_adapter és privada)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> adaptador:MutableLiveData&lt;AdaptadorLlocs&gt; =_adaptador

    <span style="color:#75715e">// Mètode per eliminar un lloc de la llista de llocs
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Es modificarà el model, i s&#39;avisarà l&#39;adaptador per
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// indicar que s&#39;ha eliminat un element i es refresque.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">removeLloc</span>(lloc:Lloc){
        Llocs.remove(lloc)
        adaptador.value<span style="color:#f92672">?.</span>notifyDataSetChanged()
    }
    <span style="color:#75715e">// Livedata per gestionar els clics
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> llocLongClicked = MutableLiveData&lt;Lloc?&gt;()
    <span style="color:#66d9ef">var</span> llocClicked = MutableLiveData&lt;Lloc?&gt;()

}
</code></pre></div><p>La resta de classes per gestionar el RecyclerView (classes <em>AdaptadorLlocs</em>, <em>llocViewHolder</em>, <em>Llocs</em> i <em>ConfirmDeleteDialog</em>) seran, com ja hem comentat, exactament iguals que en el cas de DAMLlocs.</p>
<blockquote>
<p><strong>Documentació oficial sobre Layout Inflater i LiveData</strong></p>
<ul>
<li>
<p><a href="https://developer.android.com/reference/android/view/LayoutInflater">https://developer.android.com/reference/android/view/LayoutInflater</a></p>
</li>
<li>
<p><a href="https://developer.android.com/topic/libraries/architecture/livedata">https://developer.android.com/topic/libraries/architecture/livedata</a></p>
</li>
</ul>
</blockquote>
<h2 id="4-activitat-editlloc">4. Activitat EditLloc</h2>
<p>L&rsquo;activitat <em>EditLloc</em> tindrà, de moment, la mateixa funcionalitat que a l&rsquo;exercici de DAMLlocs, i ens servirà tant per modificar un lloc existent, com per a crear un lloc nou. Cal remarcar que es tracta d&rsquo;una activitat independent, no d&rsquo;un fragment accessible des del menú.</p>
<p>Podem crear directament l&rsquo;activitat i reemplaça el codi, o copiar-la per parts: per una banda el fitxer XML del layout (<em>layout/activity_edit_lloc.xml</em>) i per altra la classe <em>EditLloc</em>. A més, no oblidem que caldrà registrar l&rsquo;activitat al fitxer de <em>Manifest</em> amb:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;activity</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;.EditLloc&#34;</span><span style="color:#f92672">&gt;&lt;/activity&gt;</span>)
</code></pre></div><p>Quan copiem el codi de la interfície, veurem com ens marca error amb les referències als identificadors (<code>android:id=&quot;@+id/guidelineXX&quot;</code>, etc.). L&rsquo;Android Studio ens suggerirà l&rsquo;opció per crear automàticament estos recursos (<em>Create id value resource</em>).</p>
<p>L&rsquo;únic id que no podem crear directament és el de la imatge: <code>app:srcCompat=&quot;@drawable/landscape&quot;</code>, que fa referència al fitxer <code>landscape.png</code> dels recursos <em>Drawable</em>. Amb que copiem la imatge amb aquest nom dins la carpeta <em>Drawable</em> (arrossegant-lo directament), aquest error desapareix.</p>
<p>Pel que fa a la classe, haurem de canviar, evidentment el nom del <em>package</em>, i a més, anem a eliminar les referències als Synthetics de les extensions de Kotlin. Ho veurem al següent apartat.</p>
<h3 id="41-view-binding-per-reemplaçar-els-synthetics">4.1. View Binding per reemplaçar els Synthetics</h3>
<p>Com hem comentat més amunt, a les versions més recents de Kotlin s&rsquo;han eliminat les extensions i amb elles els <code>synthetic</code> que utilitzàvem per fer referència directament als elements del Layout a través de propietats d&rsquo;extensió.</p>
<p>Així doncs, caldrà utilitzar el <code>findViewById</code> com hem fet anteriorment, o bé buscar alguna alternativa que reemplace aquesta funcionalitat. Una d&rsquo;aquestes alternatives és la lligadura de vistes o <em>View Binding</em>.</p>
<p>Abans que res, si hem copiat el codi de la nostra classe <em>EditLloc</em>, haurem d&rsquo;eliminar l&rsquo;import de les extensions de Kotlin:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.activity_edit_lloc.*
</code></pre></div><p>Ara caldrà activat el <em>View Binding</em>. Per a això, caldra indicar al fitxer <em><strong>build.gradle</strong></em> el següent:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">android <span style="color:#f92672">{</span>
    <span style="color:#f92672">...</span>
    buildFeatures <span style="color:#f92672">{</span>
        viewBinding <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>I ara, per utilitzar-ho en la classe cal modificar la forma en que instanciem l&rsquo;XML. En lloc d&rsquo;invocar <code>setContentView</code> amb l&rsquo;identificador del <em>layout</em>, ho farem passant-li la vista instanciada prèviament amb View Binding.</p>
<p>És a dir, en el mètode <code>onCreate</code> de l&rsquo;activitat:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_edit_lloc)
        <span style="color:#f92672">..</span>.
}
</code></pre></div><p>Modificarem la última línia per les següents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
        <span style="color:#66d9ef">val</span> binding = ActivityEditLlocBinding.inflate(layoutInflater)
        setContentView(binding.root)
        . . . 
}
</code></pre></div><p>Amb aquest <code>ActivityEditLlocBinding</code> veurem que l&rsquo;Android Studio ens demana afegir l&rsquo;import següent:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">import</span> com.ieschabas.pmdm.myplaces20.databinding.ActivityEditLlocBinding.
</code></pre></div><p>I per accedir a les propietats ho farem a través d&rsquo;aquesta variable <em>binding</em>, de manera que, on abans feiem coses com:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">editTextNom.setText(nom)
</code></pre></div><p>Ara caldrà fer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">binding.editTextNom.setText(nom)
</code></pre></div><p>Una vegada tenim esta activitat llesta, ja podem veure funcionar la Intent del clic en la llista de llocs. Ens quedarà, com veurem d&rsquo;aci un parell d&rsquo;apartats afegir codi al botó per afegir un lloc nou.</p>
<blockquote>
<p><em><strong>Informació Addicional sobre el ViewBinding i la supressió dels Synthetics a les extensions de Kotlin</strong></em></p>
<ul>
<li>
<p><a href="https://proandroiddev.com/migrating-the-deprecated-kotlin-android-extensions-compiler-plugin-to-viewbinding-d234c691dec7">Migrating the deprecated Kotlin Android Extensions compiler plugin</a></p>
</li>
<li>
<p><a href="https://devexperto.com/view-binding/">View BINDING – El método DEFINITIVO para acceder a las vistas en ANDROID</a></p>
</li>
<li>
<p><a href="https://developer.android.com/topic/libraries/view-binding?hl=es-419">Documentació oficial sober el View Binding</a></p>
</li>
</ul>
</blockquote>
<h2 id="5-afegint-la-pantalla-dabout">5. Afegint la pantalla d&rsquo;About</h2>
<p>El següent que anem a fer és incorporar el que en la versió anterior era l&rsquo;Activitat <em>About</em> com a un nou fragment, accessible des del menú general.</p>
<p>Per a això, anem a reutilitzar el fragment de la galeria, renomenant les diferents classes i interfícies que conté.</p>
<p>Els passos a realitzar seran els següents:</p>
<ol>
<li>Canviem el nom a la carpeta <em>gallery</em>. Fem clic sobre ella amb el botó dret i seleccionem <em>Refactor</em> &gt; <em>Rename</em>, i en el diàleg reemplaçarem <em>gallery</em> per <em>about</em>:</li>
</ol>
<p><img src="../img/refactor_gallery.png" alt="Renomenant la galeria"></p>
<p>Fem el mateix amb la classe <em>GalleryFragment</em> que passarà a ser <em>AboutFragment</em>, <em>GalleryViewModel</em> que passarà a ser <em>AboutViewModel</em> i el <em>Layout fragment_gallery</em> que passarà a anomenar-se <em>fragment_about</em>.</p>
<p>Una vegada canviats els noms, editarem el layout i el reemplaçarem pel següent codi, basat en l&rsquo;About de la versió anterior, però amb alguna opció de més:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span style="color:#a6e22e">xmlns:android=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res/android&#34;</span>
    <span style="color:#a6e22e">xmlns:app=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res-auto&#34;</span>
    <span style="color:#a6e22e">xmlns:tools=</span><span style="color:#e6db74">&#34;http://schemas.android.com/tools&#34;</span>
    <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">tools:context=</span><span style="color:#e6db74">&#34;.About&#34;</span><span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;vertical&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.30&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline2&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;vertical&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.70&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline3&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;horizontal&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.10&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline4&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;horizontal&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.40&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline5&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;horizontal&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.50&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline6&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;horizontal&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.60&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline7&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;horizontal&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.70&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline8&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;horizontal&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.80&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/guideline9&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:orientation=</span><span style="color:#e6db74">&#34;horizontal&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintGuide_percent=</span><span style="color:#e6db74">&#34;0.90&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;ImageView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/aboutImg&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;0dp&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;0dp&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintBottom_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline4&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintEnd_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline2&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintHorizontal_bias=</span><span style="color:#e6db74">&#34;1.0&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintStart_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintTop_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline3&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintVertical_bias=</span><span style="color:#e6db74">&#34;1.0&#34;</span>
        <span style="color:#a6e22e">app:srcCompat=</span><span style="color:#e6db74">&#34;@drawable/avatar&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;TextView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/aboutTextView&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:text=</span><span style="color:#e6db74">&#34;@string/About&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintBottom_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline5&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintEnd_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline2&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintStart_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintTop_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline4&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintVertical_bias=</span><span style="color:#e6db74">&#34;0.97&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;TextView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/aboutMaintainer&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:text=</span><span style="color:#e6db74">&#34;@string/MaintaindedBy&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintBottom_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline6&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintEnd_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline2&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintStart_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintTop_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline5&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintVertical_bias=</span><span style="color:#e6db74">&#34;0.97&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;TextView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/nomAlumne&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:text=</span><span style="color:#e6db74">&#34;@string/nomAlumne&#34;</span>
        <span style="color:#a6e22e">android:textColor=</span><span style="color:#e6db74">&#34;@color/black&#34;</span>
        <span style="color:#a6e22e">android:textSize=</span><span style="color:#e6db74">&#34;24sp&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintBottom_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline7&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintEnd_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline2&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintStart_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintTop_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline6&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;TextView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/aboutVersionText&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:text=</span><span style="color:#e6db74">&#34;@string/aboutVersion&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintBottom_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline8&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintEnd_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline2&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintStart_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintTop_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline7&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintVertical_bias=</span><span style="color:#e6db74">&#34;0.97&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;TextView</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/aboutVersion&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:text=</span><span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#a6e22e">android:textColor=</span><span style="color:#e6db74">&#34;@color/black&#34;</span>
        <span style="color:#a6e22e">android:textSize=</span><span style="color:#e6db74">&#34;24sp&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintBottom_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline9&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintEnd_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline2&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintStart_toStartOf=</span><span style="color:#e6db74">&#34;@+id/guideline&#34;</span>
        <span style="color:#a6e22e">app:layout_constraintTop_toTopOf=</span><span style="color:#e6db74">&#34;@+id/guideline8&#34;</span> <span style="color:#f92672">/&gt;</span>

<span style="color:#f92672">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</code></pre></div><p>Com veiem, hem afegit algunes guíes més, i algun que altre TextView addicional. En aquest punt,  <strong>haureu de crear els recursos de tipus String que no tingueu definits</strong>.</p>
<p>Ara modifiquem l'<em>AboutFragment</em> i l'<em>AboutViewModel</em> per tal que inicialitzen i observen els textViews corresponents a l&rsquo;autor/mantenidor (com ja teniem) i a la versió de l&rsquo;aplicació, que hem afegit com a novetat en esta pantalla.</p>
<p>Veiem com queda cadascun:</p>
<ul>
<li><em><strong>classe AboutViewModel</strong></em></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">package</span> com.ieschabas.pmdm.myplaces20.ui.about

<span style="color:#66d9ef">import</span> androidx.lifecycle.LiveData
<span style="color:#66d9ef">import</span> androidx.lifecycle.MutableLiveData
<span style="color:#66d9ef">import</span> androidx.lifecycle.ViewModel

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AboutViewModel</span> : ViewModel() {

    <span style="color:#75715e">// Definim els valors privats _maintainer i _currentVersion, 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// com a MutableLiveData, així com les propietats observables
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// equivalents maintainer i _currentVersions
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> _maintainer = MutableLiveData&lt;String&gt;().apply {
        value = <span style="color:#e6db74">&#34;@Alumne&#34;</span>
    }
    <span style="color:#66d9ef">val</span> maintainer: LiveData&lt;String&gt; = _maintainer

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> _currentVersion = MutableLiveData&lt;String&gt;().apply {
        value = <span style="color:#e6db74">&#34;2.0&#34;</span>
    }
    <span style="color:#66d9ef">val</span> currentVersion: LiveData&lt;String&gt; = _currentVersion
}
</code></pre></div><ul>
<li><em><strong>Classe AboutFragment</strong></em></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">package</span> com.ieschabas.pmdm.myplaces20.ui.about

<span style="color:#66d9ef">import</span> ...

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AboutFragment</span> : Fragment() {
    
    <span style="color:#75715e">// Declarem el ViewModel per a la seua 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// inicialització posterior
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> aboutViewModel: AboutViewModel

    <span style="color:#75715e">// I definim el mètode que ens tornarà la vista quan 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// aquesta s&#39;ha de crear
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreateView</span>(
            inflater: LayoutInflater,
            container: ViewGroup?,
            savedInstanceState: Bundle?
    ): View? {
        <span style="color:#75715e">// Inicialitzem aci el ViewModel a través de ViewModelProvider
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// I instanciem l&#39;XML al contenidor
</span><span style="color:#75715e"></span>        aboutViewModel =
                ViewModelProvider(<span style="color:#66d9ef">this</span>).<span style="color:#66d9ef">get</span>(AboutViewModel<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
        <span style="color:#66d9ef">val</span> root = inflater.inflate(R.layout.fragment_about, container, <span style="color:#66d9ef">false</span>)

        <span style="color:#75715e">// Definim els observers per actualitzar automàticament els TextViews
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// (encara que aquests no es modificaran en temps d&#39;exexució)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> maintainerTextView: TextView = root.findViewById(R.id.nomAlumne)
        aboutViewModel.maintainer.observe(viewLifecycleOwner, Observer {
            maintainerTextView.text = <span style="color:#66d9ef">it</span>
        })

        <span style="color:#66d9ef">val</span> versionTextView: TextView = root.findViewById(R.id.aboutVersion)
        aboutViewModel.currentVersion.observe(viewLifecycleOwner, Observer {
            versionTextView.text = <span style="color:#66d9ef">it</span>
        })
        <span style="color:#75715e">// I finalment retornem la vista
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> root
    }
}
</code></pre></div><h2 id="6-afegint-nous-llocs">6. Afegint nous llocs</h2>
<p>Anteriorment hem vist com modificar un lloc del <em>RecyclerView</em> llançant una <em>Intent</em> sobre l&rsquo;activitat <em>EditLloc</em>. Ara ens queda afegir un lloc nou mitjançant la icona flotant que tenim a l&rsquo;activitat principal.</p>
<p>Per a això, abans que res, editarem el fitxer de recurs <em>layout/app_bar_main.xml</em> per modificar la icona del botó flotant. Localitzem l&rsquo;etiqueta del <code>FloatingActionButton</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;com.google.android.material.floatingactionbutton.FloatingActionButton</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/fab&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:layout_gravity=</span><span style="color:#e6db74">&#34;bottom|end&#34;</span>
        <span style="color:#a6e22e">android:layout_margin=</span><span style="color:#e6db74">&#34;@dimen/fab_margin&#34;</span>
        <span style="color:#a6e22e">app:srcCompat=</span><span style="color:#e6db74">&#34;@android:drawable/ic_dialog_email&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><p>I modifiquem el valor d'<code>app:srcCompat</code> per <code>@android:drawable/ic_menu_add</code>, de l'<em>stock</em> d&rsquo;icones d&rsquo;Android.</p>
<p>Ara ens quedarà afegir el codi a l&rsquo;activitat principal per obrir l&rsquo;activitat d&rsquo;edició per afegir un lloc nou. Per a això només haurem de localitzar a la classe <em>MainActivity</em> el codi per gestionar el clic sobre aquesta icona:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> fab: FloatingActionButton = findViewById(R.id.fab)
fab.setOnClickListener { view <span style="color:#f92672">-&gt;</span>
    Snackbar.make(view, <span style="color:#e6db74">&#34;Replace with your own action&#34;</span>, Snackbar.LENGTH_LONG)
        .setAction(<span style="color:#e6db74">&#34;Action&#34;</span>, <span style="color:#66d9ef">null</span>).show()
    }
</code></pre></div><p>I en lloc de mostrar un <em>Snackbar</em>, crearem una <em>Intent</em> per iniciar l&rsquo;activitat d&rsquo;editar lloc.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> fab: FloatingActionButton = findViewById(R.id.fab)
fab.setOnClickListener { view <span style="color:#f92672">-&gt;</span>
    <span style="color:#66d9ef">val</span> intent = Intent(<span style="color:#66d9ef">this</span>, EditLloc<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
    startActivity(intent)
    <span style="color:#75715e">/*Snackbar.make(view, &#34;Replace with your own action&#34;, Snackbar.LENGTH_LONG)
</span><span style="color:#75715e">        .setAction(&#34;Action&#34;, null).show()*/</span>
    }
</code></pre></div><p>Com que no li passem cap valor, aquesta activitat d&rsquo;edició de llocs ja interpreta que anem a afegir un nou element, pel que amb això ja hauriem finalitzat l&rsquo;adaptació de l&rsquo;aplicació completa.</p>
<h2 id="7-personalitzant-el-menu">7. Personalitzant el menu</h2>
<p>Una vegada ja tenim la funcionalitat migrada del projecte inicial a la nova estructura, només ens queda realitzar els canvis corresponents al menú.</p>
<p>Per a això caldrà modificar el recurs <em>menu/activity_main_drawer.xml</em>. Però abans, anem a importar les icones que utilitzarem per al menú, que de moment en seran dos. Podeu descarregar icones en format vectorial (svg) des d&rsquo;Internet (per exemple des de <a href="https://www.flaticon.com/">https://www.flaticon.com/</a>) o fins i tot dissenyar-les vosaltres.</p>
<p>Per tal d&rsquo;importar les icones, en la vista d'<em>Android</em> fem clic sobre els recursos amb el botó dret i busquem l&rsquo;opció <em>New &gt; Vector Asset</em>:</p>
<p><img src="../img/vector_asset.png" alt="Afegint un nou recurs de tipus vector"></p>
<p>La finestra que ens apareix tindrà el següent aspecte, i en ella, seleccionarem el vector que hajam descarregat i li direm que el volem amb una grandària de 24dpx24dp. En la finestra següent, indicarem que es guarde en la ruta per defecte <em>main &gt; drawable &gt; ic_home.xml</em></p>
<p><img src="../img/vector_asset2.png" alt="Afegint un nou recurs de tipus vector"></p>
<p><img src="../img/vector_asset3.png" alt="Afegint un nou recurs de tipus vector"></p>
<p>Realitzarem el mateix procediment per a la icona de l&rsquo;entrada <em>About</em>.</p>
<p>Finalment, només ens queda referenciar a aquestes icones en el fitxer de menú i modificar els IDs i els recursos de tipus String per a que mostren <em>Home</em> i <em>About</em>. També comentarem de moment la última entrada que no anem a utilitzar:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;menu</span> <span style="color:#a6e22e">xmlns:android=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res/android&#34;</span>
    <span style="color:#a6e22e">xmlns:tools=</span><span style="color:#e6db74">&#34;http://schemas.android.com/tools&#34;</span>
    <span style="color:#a6e22e">tools:showIn=</span><span style="color:#e6db74">&#34;navigation_view&#34;</span><span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;group</span> <span style="color:#a6e22e">android:checkableBehavior=</span><span style="color:#e6db74">&#34;single&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;item</span>
            <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/nav_home&#34;</span>
            <span style="color:#a6e22e">android:icon=</span><span style="color:#e6db74">&#34;@drawable/ic_home&#34;</span>
            <span style="color:#a6e22e">android:title=</span><span style="color:#e6db74">&#34;@string/menu_home&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;item</span>
            <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/nav_about&#34;</span>
            <span style="color:#a6e22e">android:icon=</span><span style="color:#e6db74">&#34;@drawable/ic_about_us&#34;</span>
            <span style="color:#a6e22e">android:title=</span><span style="color:#e6db74">&#34;@string/About&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#75715e">&lt;!--item
</span><span style="color:#75715e">            android:id=&#34;@+id/nav_slideshow&#34;
</span><span style="color:#75715e">            android:icon=&#34;@drawable/ic_menu_slideshow&#34;
</span><span style="color:#75715e">            android:title=&#34;@string/menu_slideshow&#34; /--&gt;</span>
    <span style="color:#f92672">&lt;/group&gt;</span>
<span style="color:#f92672">&lt;/menu&gt;</span>
</code></pre></div><p>A més,<strong>cal tindre en compte que en aquest cas, hem modificat l&rsquo;identificador del menú, pel que caldrà realitzar els canvis corresponents al fragment del recurs <em>navigation/mobile_navigation.xml</em></strong> <em>(Podeu tornar a donar una ullada a l&rsquo;esquema on es mostren tots els components per veure-ho més clar).</em> Així doncs, modificarem el segon <em>fragment</em> del <em>mobile_navigation.xml</em> amb:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;fragment</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/nav_about&#34;</span>
        <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;com.ieschabas.pmdm.myplaces20.ui.about.AboutFragment&#34;</span>
        <span style="color:#a6e22e">android:label=</span><span style="color:#e6db74">&#34;About&#34;</span>
        <span style="color:#a6e22e">tools:layout=</span><span style="color:#e6db74">&#34;@layout/fragment_about&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><p>I també modificarem l&rsquo;activitat principal, reemplaçant el recurs <em>R.id.nav_gallery</em> de la línia:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">appBarConfiguration = AppBarConfiguration(setOf(
                R.id.nav_home, R.id.nav_gallery, R.id.nav_slideshow), drawerLayout)
</code></pre></div><p>pel recurs <em>R.id.nav_about</em> que hem creat:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">appBarConfiguration = AppBarConfiguration(setOf(
                R.id.nav_home, R.id.nav_about, R.id.nav_slideshow), drawerLayout)
</code></pre></div><p>Només ens queda un últim detall. Modificar el recurs <em>layout/nav_header_main</em> per personalitzar la portada del menú. Si editem el recurs, veurem que es tracta d&rsquo;un <em>LinearLayout</em>, amb una icona i dos TextViews.</p>
<p>Per tal de modificar-ne el fons, caldrà canviar la propietat <em>android:background</em> del <em>LinearLayout</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">android:background=&#34;@drawable/side_nav_bar&#34;
</code></pre></div><p>Per exemple per:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">android:background=&#34;@drawable/landscape&#34;
</code></pre></div><p>Ara, per modificar-ne la icona farem ús de l'<em>Image Assitant Studio</em> i utilitzarem una imatge de l&rsquo;stock . Per a això fem click amb el botó dret sobre els recursos i seleccionem <em>New &gt; Image Assistant</em>, i seguim els passos indicats en la documentació oficial:</p>
<ol>
<li>Deixem el camp <em>Icon Type</em> com a <em>Launcher Icons (Adaptive &amp; Legacy)</em>, i canviem el nom si no el volem sobreescriure(per exemple <em>ic_launcher_places</em>)</li>
<li>En <em>Foreground Layer</em> (primer pla, referent a la imatge de la icona) seleccionem l'<em>Asset Type</em> de tipus <em>Clip Art</em> per especificar una imatge del conjunt d&rsquo;icones de Material Design, i busquem una icona relacionada amb l&rsquo;aplicació (Per exemple <em>places</em>). Podem modificar el color i escalar-la com desitgem.</li>
<li>A la pestanya de <em>Background Layer</em> (capa amb el fons) en <em>Asset Type</em> podem triar entre un color de fons o una imatge.</li>
<li>I ja en la pestanya d'<em>Options</em> comprovem que tot estiga correcte, i confirmem  si volem generar icones heretades, redones i de la Google Play Store.</li>
<li>Per acabar, farem clic <em>Next</em> per passar a la pantalla de configuració següent, on se&rsquo;ns informarà de tots els recursos que van a generar-se, així com si aquests ja existien i els volem sobreescriure. Farem click en <em>Finish</em> per confirmar-ho tot.</li>
</ol>
<p>Amb això ja podem modificar la icona reemplaçant a l'<em>ImageView</em> la línia:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">app:srcCompat=&#34;@mipmap/ic_launcher_round&#34; /&gt;
</code></pre></div><p>Pel nou recurs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">app:srcCompat=&#34;@mipmap/ic_launcher_places_round&#34; /&gt;
</code></pre></div><p>I per modificar el contingut dels dos <em>TextViews</em>, el que farem serà modificar els recursos d&rsquo;Strings, per canviar el valor de <em>@string/nav_header_title</em> i <em>@string/nav_header_subtitle</em>, amb el nom de l&rsquo;aplicació i un subtítol.</p>
<p><img src="../img/myplaces_2_headers.png" alt="Canvis en la capçalera del menú"></p>
<blockquote>
<p><em><strong>Documentació oficial sobre l&rsquo;Image Assistant</strong></em></p>
<p><a href="https://developer.android.com/studio/write/image-asset-studio">https://developer.android.com/studio/write/image-asset-studio</a></p>
</blockquote>
<h2 id="8-conclussions-i-consideracions-finals">8. Conclussions i consideracions finals</h2>
<p>En aquest document hem vist com adaptar l&rsquo;estructura d&rsquo;un projecte basat en activitats a un <em>Navigation Drawer</em> basat en fragments i seguint el model <em>Model-Vista-ViewModel</em>. També hem vist com eliminar les dependències dels <em>deprecats</em> <code>synthetic</code> de les extensions de Kotlin per a Android i reemplaçar-les pel <em>View Binding</em>, així com editar les nostres icones per a les aplicacions.</p>
<p>Tot i que funcionalment no hem guanyat massa respecte a l&rsquo;aplicació de DAMLlocs que vam desenvolupar anteriorment, hem sentat les bases de molts conceptes i paradigmes nous, i hem establert la base d&rsquo;una aplicació sobre la que anem a treballar posteriorment per conéixer noves funcionalitats d&rsquo;Android.</p>
<p>Per tal de verificar el projecte, si hem anat seguint tota l&rsquo;explicació anterior, l&rsquo;estructura de carpetes i fitxers d&rsquo;aquest, deu ser semblant a la següent:</p>
<p><img src="../img/esquema_final.png" alt="Organització final de fitxers i recursos"></p>

        </article>
<aside class="table-of-contents">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-creació-del-projecte">1. Creació del projecte</a></li>
    <li><a href="#2-adaptant-myplacesdamllocs-a-lestructura-de-myplaces-20">2. Adaptant MyPlaces/DamLlocs a l&rsquo;estructura de MyPlaces 2.0</a></li>
    <li><a href="#3-adaptació-de-la-llista-de-llocs">3. Adaptació de la llista de llocs</a>
      <ul>
        <li><a href="#31-el-model-mvvm">3.1. El model MVVM</a></li>
        <li><a href="#32-divisió-de-funcionalitat-entre-la-vista-i-el-viewmodel">3.2. Divisió de funcionalitat entre la vista i el ViewModel</a></li>
      </ul>
    </li>
    <li><a href="#4-activitat-editlloc">4. Activitat EditLloc</a>
      <ul>
        <li><a href="#41-view-binding-per-reemplaçar-els-synthetics">4.1. View Binding per reemplaçar els Synthetics</a></li>
      </ul>
    </li>
    <li><a href="#5-afegint-la-pantalla-dabout">5. Afegint la pantalla d&rsquo;About</a></li>
    <li><a href="#6-afegint-nous-llocs">6. Afegint nous llocs</a></li>
    <li><a href="#7-personalitzant-el-menu">7. Personalitzant el menu</a></li>
    <li><a href="#8-conclussions-i-consideracions-finals">8. Conclussions i consideracions finals</a></li>
  </ul>
</nav>

</aside>

<script>

    (function () {
        let entries = document.querySelectorAll(".table-of-contents li");

        for (entry of entries) {
            entry.addEventListener("click", function (e) {
                
                e.stopPropagation();
                for (sel of document.querySelectorAll(".selected"))
                    sel.classList.remove("selected");
                e.currentTarget.classList.add("selected");
                
                for (item of e.currentTarget.children)
                    if (item == "[object HTMLUListElement]")
                        if (item.style.display == "none")
                            item.style.display = "block";
                        else item.style.display = "none"

            });
        }

    
    let entriesh2 = document.querySelectorAll(".table-of-contents li > ul");

        for (entry of entriesh2) {
            entry.style.display = "none";
        }


    })();

</script>        

</div> 

<div class="footer-container">
    <a href="https://socquique.github.io/2dam/"><h3>Docencia</h3></a>
</div>
</body>



</html>